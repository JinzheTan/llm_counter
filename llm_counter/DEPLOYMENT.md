# Vercel 部署指南

## 部署前检查清单

### 1. 环境变量准备
确保你有有效的 OpenAI API 密钥：
- [ ] OpenAI API 密钥已获取
- [ ] 密钥有足够的配额余额

### 2. 代码检查
- [x] 移除了所有非 OpenAI 模型
- [x] 添加了使用限制（每天100次）
- [x] 修复了输入时立即计算的问题
- [x] 添加了 CORS 头
- [x] 优化了错误处理
- [x] 添加了请求大小和内容限制

## 部署步骤

### 方法一：通过 Vercel CLI

1. 安装 Vercel CLI：
```bash
npm i -g vercel
```

2. 在项目根目录登录：
```bash
vercel login
```

3. 部署：
```bash
vercel
```

4. 设置环境变量：
```bash
vercel env add OPENAI_API_KEY
```

### 方法二：通过 Vercel 网站

1. 访问 [vercel.com](https://vercel.com)
2. 连接你的 GitHub 仓库
3. 选择 `llm_counter` 文件夹作为根目录
4. 在环境变量中添加：
   - `OPENAI_API_KEY`: 你的 OpenAI API 密钥

## 环境变量配置

在 Vercel 项目设置中添加以下环境变量：

| 变量名 | 值 | 说明 |
|--------|-----|------|
| `OPENAI_API_KEY` | sk-... | OpenAI API 密钥 |

## 部署后验证

1. 访问部署的 URL
2. 检查模型选择器是否只显示 OpenAI 模型
3. 测试文本输入和单词计数功能
4. 验证使用限制是否工作
5. 测试生成和示例文章功能

## 成本控制建议

### API 使用优化
- 使用 GPT-4o-mini 而不是 GPT-4o（生成文章）
- 限制每天最多 100 次请求
- 限制文本长度最多 10,000 字符
- 限制单词数量最多 20 个

### 预期成本
基于当前限制，预计每天成本：
- 100 次计数请求：约 $0.50-1.00
- 少量文章生成：约 $0.10-0.30
- **每天总成本：约 $0.60-1.30**

## 监控和维护

### 使用情况监控
- 在 Vercel 面板查看函数调用次数
- 监控 OpenAI API 使用情况
- 设置账单警报

### 故障排除
- 检查 Vercel 函数日志
- 验证环境变量设置
- 检查 OpenAI API 密钥状态

## 安全注意事项

- ✅ API 密钥存储在环境变量中
- ✅ 添加了请求大小限制
- ✅ 添加了使用频率限制
- ✅ 验证了用户输入
- ✅ 实施了错误处理

## 更新部署

要更新应用：
1. 推送新代码到 GitHub
2. Vercel 将自动重新部署
3. 或使用 `vercel --prod` 手动部署

## 常见问题

### Q: 部署失败怎么办？
A: 检查：
- 是否选择了正确的根目录（llm_counter）
- 环境变量是否正确设置
- API 密钥是否有效

### Q: API 调用失败？
A: 检查：
- OpenAI API 密钥是否有效
- 账户是否有足够余额
- 是否超出了 API 限制

### Q: 使用限制不工作？
A: 客户端使用限制基于 localStorage，如果需要服务端限制，需要集成数据库。 